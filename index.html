<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>P2P Calculator</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  .block { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  .row { display: flex; align-items: center; gap: 6px; flex-wrap: nowrap; white-space: nowrap; margin-bottom: 6px; }
  label { font-weight: bold; white-space: nowrap; }
  select.short, input.num { padding: 6px; border-radius: 6px; border:1px solid #ccc; }
  select.short { width: 120px; }
  input.num { width: 60px; }
  button { padding: 6px 12px; border: none; border-radius: 6px; background:#007bff; color:white; cursor:pointer; }
  button:hover { background:#005fcc; }
  .add-btn { margin-top: 10px; }
  .remove-btn { background:#dc3545; margin-left: 6px; }
  .remove-btn:hover { background:#a71d2a; }
  .commission-label { color: #555; font-size: 0.9em; }
</style>
</head>
<body>
<h2>P2P Арбітраж Калькулятор</h2>

<div id="calculator">
  <div class="block" data-block="1">
    <h3>1. Картка → Купуєш → Продаєш</h3>
    <div class="row">
      <label>Buy:</label>
      <select class="short">
        <option>Binance</option><option>Bybit</option><option>OKX</option><option>MEXC</option><option>Telegram</option>
      </select>

      <label>Sell:</label>
      <select class="short">
        <option>Binance</option><option>Bybit</option><option>OKX</option><option>MEXC</option><option>Telegram</option>
      </select>

      <label>UAH:</label>
      <input type="number" class="num" placeholder="10000" />

      <label>Buy:</label>
      <input type="number" class="num" placeholder="40.2" />

      <label>Sell:</label>
      <input type="number" class="num" placeholder="40.6" />

      <label class="commission-label">Комісія %:</label>
      <input type="number" class="num" placeholder="0" />

      <button onclick="calcRow(this)">=</button>
      <span><b>0 грн (0%)</b></span>
      <button class="remove-btn" onclick="resetRow(this)">×</button>
    </div>
    <button class="add-btn" onclick="addRow(this)">Додати рядок</button>
  </div>

  <div class="block" data-block="2">
    <h3>2. Біржа → Продаєш → Відкуповуєш (результат у USDT)</h3>
    <div class="row">
      <label>Sell:</label>
      <select class="short">
        <option>Binance</option><option>Bybit</option><option>OKX</option><option>MEXC</option><option>Telegram</option>
      </select>

      <label>Buy:</label>
      <select class="short">
        <option>Binance</option><option>Bybit</option><option>OKX</option><option>MEXC</option><option>Telegram</option>
      </select>

      <label>USDT:</label>
      <input type="number" class="num" placeholder="500" />

      <label>Sell (UAH):</label>
      <input type="number" class="num" placeholder="45.55" />

      <label>Buy (UAH):</label>
      <input type="number" class="num" placeholder="43.50" />

      <label class="commission-label">Комісія %:</label>
      <input type="number" class="num" placeholder="0" />

      <button onclick="calcRow(this)">=</button>
      <span><b>0 USDT (0%)</b></span>
      <button class="remove-btn" onclick="removeRow(this)">×</button>
    </div>
    <button class="add-btn" onclick="addRow(this)">Додати рядок</button>
  </div>
</div>

<script>
function calcRow(btn) {
  const row = btn.parentElement;
  const inputs = row.querySelectorAll('input.num');
  const commission = +inputs[inputs.length-1].value || 0;
  let profit = 0;
  let percent = 0;
  let outAmount = 0;

  if (row.parentElement.dataset.block === "1") {
    const amount = +inputs[0].value;
    const buy = +inputs[1].value;
    const sell = +inputs[2].value;
    if(!amount || !buy || !sell) return;
    const usdt = amount / buy;
    outAmount = usdt * sell * (1 - commission/100);
    profit = outAmount - amount;
    percent = (profit / amount * 100).toFixed(2);
    row.querySelector('span b').innerText = `${profit.toFixed(2)} грн (${percent}%) | Зараз: ${outAmount.toFixed(2)} грн`;
  } else {
    const amountUSDT = +inputs[0].value;
    const sellUAH = +inputs[1].value;
    const buyUAH = +inputs[2].value;
    if(!amountUSDT || !sellUAH || !buyUAH) return;
    const uahAfterSell = amountUSDT * sellUAH * (1 - commission/100);
    const usdtBack = uahAfterSell / buyUAH * (1 - commission/100);
    profit = usdtBack - amountUSDT;
    percent = (profit / amountUSDT * 100).toFixed(2);
    row.querySelector('span b').innerText = `${profit.toFixed(4)} USDT (${percent}%) | Зараз: ${usdtBack.toFixed(4)} USDT`;
  }
}

function addRow(btn) {
  const block = btn.parentElement;
  const firstRow = block.querySelector('.row');
  const newRow = firstRow.cloneNode(true);
  newRow.querySelectorAll('input').forEach(i => i.value = '');
  const isBlock1 = block.dataset.block === "1";
  newRow.querySelector('span b').innerText = isBlock1 ? '0 грн (0%)' : '0 USDT (0%)';
  block.insertBefore(newRow, btn);
}

function removeRow(btn) {
  const row = btn.parentElement;
  const block = row.parentElement;
  if(block.dataset.block === "1" && row === block.querySelector('.row')) {
    resetRow(btn);
    return;
  }
  if(block.querySelectorAll('.row').length > 1){
    row.remove();
  }
}

function resetRow(btn) {
  const row = btn.parentElement;
  row.querySelectorAll('input').forEach(i => i.value = '');
  const isBlock1 = row.parentElement.dataset.block === "1";
  row.querySelector('span b').innerText = isBlock1 ? '0 грн (0%)' : '0 USDT (0%)';
}
</script>

</body>
</html>